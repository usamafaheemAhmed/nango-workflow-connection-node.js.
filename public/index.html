<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Integrations</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Lato", sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: 100vh;
      }

      h2 {
        margin: 30px 0 20px;
        font-size: 28px;
        font-weight: 600;
        color: #333;
      }

      #tools {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        max-width: 1000px;
      }

      .tool-card {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        width: 250px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        transition: transform 0.2s ease;
      }

      .tool-card:hover {
        transform: translateY(-5px);
      }

      .tool-card img {
        width: 60px;
        height: 60px;
        object-fit: contain;
        margin-bottom: 15px;
      }

      .tool-card h3 {
        font-size: 18px;
        font-weight: 600;
        margin: 10px 0 15px;
        color: #333;
      }

      .tool-btn {
        background-color: #e16f56;
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 6px;
        font-size: 15px;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .tool-btn:hover {
        background-color: #28a745;
      }
    </style>
  </head>
  <body>
    <h2>Available Tools</h2>
    <div id="tools"></div>

    <script>
      // âœ… Mock MemberSpace: pull email + name from URL or use defaults
      const params = new URLSearchParams(window.location.search);
      const memberEmail = params.get("email") || "usamafaheemahmed80@gmail.com";
      const memberName = params.get("name") || "Usama Faheem";
      const memberId = params.get("Members_Id") || "5965254";

      console.log("ðŸ§ª Using mock user:", memberEmail, memberName,memberId);

      async function loadTools() {
        const res = await fetch("/tools"); // Express backend
        const tools = await res.json();

        const container = document.getElementById("tools");
        container.innerHTML = "";

        tools.forEach((tool) => {
          const card = document.createElement("div");
          card.className = "tool-card";

          const logo = document.createElement("img");
          logo.src = tool.logo;
          logo.alt = tool.name;

          const title = document.createElement("h3");
          title.textContent = tool.name;

          const btn = document.createElement("button");
          btn.className = "tool-btn";
          btn.textContent = `Connect`;
          btn.onclick = async () => {
            const res = await fetch("/create-session", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                clientId: memberId, // âœ… use MemberSpace ID as unique clientId
                clientName: memberName, // optional
                memberEmail: memberEmail, // optional
                toolKey: tool.key,
              }),
            });
            const data = await res.json();
            console.log("Session response:", data);

            if (!data.data || !data.data.token) {
              alert("Could not create session");
              return;
            }

            const sessionToken = data.data.token;
            window.location.href = `https://connect.nango.dev?session_token=${sessionToken}`;
          };

          card.appendChild(logo);
          card.appendChild(title);
          card.appendChild(btn);
          container.appendChild(card);
        });
      }

      loadTools();
    </script>
  </body>
</html>
